import { make } from "./ui";
import bgIcon from "./svg/background.svg";
import borderIcon from "./svg/border.svg";
import stretchedIcon from "./svg/stretched.svg";

/**
 * Working with Block Tunes
 */
export default class Tunes {
    /**
     * @param {object} tune - image tool Tunes managers
     * @param {object} tune.api - Editor API
     * @param {object} tune.actions - list of user defined tunes
     * @param {Function} tune.onChange - tune toggling callback
     */
    constructor({ api, actions, onChange }) {
        this.api = api;
        this.actions = actions;
        this.onChange = onChange;
        this.buttons = [];
    }

    /**
     * Available Image tunes
     *
     * @returns {{name: string, icon: string, title: string}[]}
     */
    static get tunes() {
        return [
            {
                name: "withBorder",
                icon:
                    '<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M15.8 10.592v2.043h2.35v2.138H15.8v2.232h-2.25v-2.232h-2.4v-2.138h2.4v-2.28h2.25v.237h1.15-1.15zM1.9 8.455v-3.42c0-1.154.985-2.09 2.2-2.09h4.2v2.137H4.15v3.373H1.9zm0 2.137h2.25v3.325H8.3v2.138H4.1c-1.215 0-2.2-.936-2.2-2.09v-3.373zm15.05-2.137H14.7V5.082h-4.15V2.945h4.2c1.215 0 2.2.936 2.2 2.09v3.42z"/></svg>',
                title: "With border",
            },
            {
                name: "stretched",
                icon:
                    '<svg width="17" height="10" viewBox="0 0 17 10" xmlns="http://www.w3.org/2000/svg"><path d="M13.568 5.925H4.056l1.703 1.703a1.125 1.125 0 0 1-1.59 1.591L.962 6.014A1.069 1.069 0 0 1 .588 4.26L4.38.469a1.069 1.069 0 0 1 1.512 1.511L4.084 3.787h9.606l-1.85-1.85a1.069 1.069 0 1 1 1.512-1.51l3.792 3.791a1.069 1.069 0 0 1-.475 1.788L13.514 9.16a1.125 1.125 0 0 1-1.59-1.591l1.644-1.644z"/></svg>',
                title: "Stretch image",
            },
            {
                name: "withBackground",
                icon:
                    '<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.043 8.265l3.183-3.183h-2.924L4.75 10.636v2.923l4.15-4.15v2.351l-2.158 2.159H8.9v2.137H4.7c-1.215 0-2.2-.936-2.2-2.09v-8.93c0-1.154.985-2.09 2.2-2.09h10.663l.033-.033.034.034c1.178.04 2.12.96 2.12 2.089v3.23H15.3V5.359l-2.906 2.906h-2.35zM7.951 5.082H4.75v3.201l3.201-3.2zm5.099 7.078v3.04h4.15v-3.04h-4.15zm-1.1-2.137h6.35c.635 0 1.15.489 1.15 1.092v5.13c0 .603-.515 1.092-1.15 1.092h-6.35c-.635 0-1.15-.489-1.15-1.092v-5.13c0-.603.515-1.092 1.15-1.092z"/></svg>',
                title: "With background",
            },
            {
                name: "centerBackground",
                icon:
                    '<svg width="20" height="20" viewBox="0 0 321.493 321.493" xmlns="http://www.w3.org/2000/svg"><path d="M0,0v321.493h321.493V0H0z M307.627,307.627H13.867V67.413h293.76V307.627z M307.627,53.547H13.867v-39.68h293.76V53.547z    "/><rect x="26.987" y="26.773" width="13.44" height="13.867"/><rect x="53.76" y="26.773" width="13.333" height="13.867"/><rect x="80.533" y="26.773" width="13.333" height="13.867"/><path d="M48.533,93.653v187.733h224.32V93.653H48.533z M258.987,267.52H62.4v-26.773l38.827-38.827l32.107,32l48-48l29.76,29.653    l47.893-47.787V267.52z M258.987,148.16l-47.893,47.787l-29.76-29.653l-48,48l-32.107-32L62.4,221.12v-113.6h196.587V148.16z"/><path d="M110.4,121.067c-13.973,0-25.28,11.307-25.28,25.28c0,13.973,11.307,25.28,25.28,25.28c13.973,0,25.28-11.307,25.28-25.28    C135.68,132.373,124.373,121.067,110.4,121.067z M110.4,157.76c-6.293,0-11.413-5.12-11.413-11.413    c0-6.293,5.12-11.413,11.413-11.413s11.413,5.12,11.413,11.413C121.813,152.64,116.693,157.76,110.4,157.76z"/></svg>',
                title: "Center background",
            },
            {
                name: "replaceBackground",
                icon: `<svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M8.533,17.067H25.6c4.719,0,8.533-3.814,8.533-8.533S30.319,0,25.6,0H8.533C3.814,0,0,3.814,0,8.533
				S3.814,17.067,8.533,17.067z"></path><path d="M8.533,119.467c4.719,0,8.533-3.814,8.533-8.533V93.867c0-4.719-3.814-8.533-8.533-8.533S0,89.148,0,93.867v17.067
				C0,115.652,3.814,119.467,8.533,119.467z"></path><path d="M213.333,17.067H230.4c4.719,0,8.533-3.814,8.533-8.533S235.119,0,230.4,0h-17.067c-4.719,0-8.533,3.814-8.533,8.533
				S208.614,17.067,213.333,17.067z"></path><path d="M8.533,68.267c4.719,0,8.533-3.814,8.533-8.533V42.667c0-4.719-3.814-8.533-8.533-8.533S0,37.948,0,42.667v17.067
				C0,64.452,3.814,68.267,8.533,68.267z"></path><path d="M332.8,102.4c-4.719,0-8.533,3.814-8.533,8.533V128c0,4.719,3.814,8.533,8.533,8.533c4.719,0,8.533-3.814,8.533-8.533
				v-17.067C341.333,106.214,337.519,102.4,332.8,102.4z"></path><path d="M341.333,59.733c0-4.719-3.814-8.533-8.533-8.533c-4.719,0-8.533,3.814-8.533,8.533V76.8
				c0,4.719,3.814,8.533,8.533,8.533c4.719,0,8.533-3.814,8.533-8.533V59.733z"></path><path d="M264.533,17.067H281.6c4.719,0,8.533-3.814,8.533-8.533S286.319,0,281.6,0h-17.067C259.814,0,256,3.814,256,8.533
				S259.814,17.067,264.533,17.067z"></path><path d="M315.733,17.067h8.533V25.6c0,4.719,3.814,8.533,8.533,8.533c4.719,0,8.533-3.814,8.533-8.533V8.533
				c0-4.719-3.814-8.533-8.533-8.533h-17.067c-4.719,0-8.533,3.814-8.533,8.533S311.014,17.067,315.733,17.067z"></path><path d="M8.533,170.667c4.719,0,8.533-3.814,8.533-8.533v-17.067c0-4.719-3.814-8.533-8.533-8.533S0,140.348,0,145.067v17.067
				C0,166.852,3.814,170.667,8.533,170.667z"></path><path d="M136.533,8.533C136.533,3.814,132.719,0,128,0h-17.067c-4.719,0-8.533,3.814-8.533,8.533s3.814,8.533,8.533,8.533H128
				C132.719,17.067,136.533,13.252,136.533,8.533z"></path><path d="M145.067,324.267H128c-4.719,0-8.533,3.814-8.533,8.533c0,4.719,3.814,8.533,8.533,8.533h17.067
				c4.719,0,8.533-3.814,8.533-8.533C153.6,328.081,149.786,324.267,145.067,324.267z"></path><path d="M93.867,324.267H76.8c-4.719,0-8.533,3.814-8.533,8.533c0,4.719,3.814,8.533,8.533,8.533h17.067
				c4.719,0,8.533-3.814,8.533-8.533C102.4,328.081,98.586,324.267,93.867,324.267z"></path><path d="M187.733,8.533c0-4.719-3.814-8.533-8.533-8.533h-17.067c-4.719,0-8.533,3.814-8.533,8.533s3.814,8.533,8.533,8.533
				H179.2C183.919,17.067,187.733,13.252,187.733,8.533z"></path><path d="M8.533,221.867c4.719,0,8.533-3.814,8.533-8.533v-17.067c0-4.719-3.814-8.533-8.533-8.533S0,191.548,0,196.267v17.067
				C0,218.052,3.814,221.867,8.533,221.867z"></path><path d="M85.333,8.533C85.333,3.814,81.519,0,76.8,0H59.733C55.014,0,51.2,3.814,51.2,8.533s3.814,8.533,8.533,8.533H76.8
				C81.519,17.067,85.333,13.252,85.333,8.533z"></path><path d="M42.667,324.267H25.6c-4.719,0-8.533,3.814-8.533,8.533c0,4.719,3.814,8.533,8.533,8.533h17.067
				c4.719,0,8.533-3.814,8.533-8.533C51.2,328.081,47.386,324.267,42.667,324.267z"></path><path d="M8.533,273.067c4.719,0,8.533-3.814,8.533-8.533v-17.067c0-4.719-3.814-8.533-8.533-8.533S0,242.748,0,247.467v17.067
				C0,269.252,3.814,273.067,8.533,273.067z"></path><path d="M17.067,298.667c0-4.719-3.814-8.533-8.533-8.533S0,293.948,0,298.667v17.067c0,4.719,3.814,8.533,8.533,8.533
				s8.533-3.814,8.533-8.533V298.667z"></path><path d="M384.896,80.619c1.502,2.987,4.514,4.719,7.646,4.719c1.28,0,2.586-0.299,3.806-0.905
				c4.216-2.108,5.931-7.236,3.823-11.452l-1.408-2.79c21.069,5.393,37.658,21.973,43.042,43.042l-2.79-1.399
				c-4.215-2.091-9.335-0.401-11.452,3.814c-2.108,4.215-0.393,9.344,3.823,11.452c0,0,17.067,8.533,17.297,8.593
				c1.101,0.503,2.295,0.845,3.584,0.845c1.118,0,2.227-0.23,3.268-0.666c1.05-0.427,1.988-1.058,2.773-1.843l17.058-17.058
				c3.336-3.337,3.336-8.738,0-12.066c-3.337-3.337-8.73-3.337-12.066,0l-4.804,4.796c-6.784-27.648-28.544-49.408-56.192-56.201
				l4.796-4.796c3.337-3.336,3.337-8.738,0-12.066c-3.336-3.337-8.73-3.337-12.066,0l-10.505,10.496
				c-2.739,2.739-6.025,5.282-7.842,8.781c-0.213,0.401-0.384,0.794-0.521,1.169c-1.143,3.123-0.137,5.786,1.382,8.841
				C379.989,70.822,382.447,75.721,384.896,80.619z"></path><path d="M503.467,170.667H341.333v-8.533c0-4.719-3.814-8.533-8.533-8.533c-4.719,0-8.533,3.814-8.533,8.533V179.2v34.133V230.4
				v34.133V281.6v34.133v8.533h-25.6H281.6h-34.133H230.4h-34.133H179.2c-4.719,0-8.533,3.814-8.533,8.533v170.667
				c0,4.719,3.814,8.533,8.533,8.533h324.267c4.719,0,8.533-3.814,8.533-8.533V179.2C512,174.481,508.186,170.667,503.467,170.667z"></path></svg>`,
                title: "Replace Background",
            },
        ];
    }

    /**
     * Styles
     *
     * @returns {{wrapper: string, buttonBase: *, button: string, buttonActive: *}}
     */
    get CSS() {
        return {
            wrapper: "",
            buttonBase: this.api.styles.settingsButton,
            button: "image-tool__tune",
            buttonActive: this.api.styles.settingsButtonActive,
        };
    }

    /**
     * Makes buttons with tunes: add background, add border, stretch image
     *
     * @param {ImageToolData} toolData - generate Elements of tunes
     * @returns {Element}
     */
    render(toolData) {
        const wrapper = make("div", this.CSS.wrapper);

        this.buttons = [];

        const tunes = Tunes.tunes.concat(this.actions);

        tunes.forEach((tune) => {
            const title = this.api.i18n.t(tune.title);
            const el = make("div", [this.CSS.buttonBase, this.CSS.button], {
                innerHTML: tune.icon,
                title,
            });

            el.addEventListener("click", () => {
                this.tuneClicked(tune.name, tune.action);
            });

            el.dataset.tune = tune.name;
            el.classList.toggle(this.CSS.buttonActive, toolData[tune.name]);

            this.buttons.push(el);

            this.api.tooltip.onHover(el, title, {
                placement: "top",
            });

            wrapper.appendChild(el);
        });

        return wrapper;
    }

    /**
     * Clicks to one of the tunes
     *
     * @param {string} tuneName - clicked tune name
     * @param {Function} customFunction - function to execute on click
     */
    tuneClicked(tuneName, customFunction) {
        if (typeof customFunction === "function") {
            if (!customFunction(tuneName)) {
                return false;
            }
        }

        const button = this.buttons.find((el) => el.dataset.tune === tuneName);

        button.classList.toggle(
            this.CSS.buttonActive,
            !button.classList.contains(this.CSS.buttonActive)
        );

        this.onChange(tuneName);
    }
}
